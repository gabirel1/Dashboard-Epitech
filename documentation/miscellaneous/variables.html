<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>dashboard_server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">dashboard_server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content miscellaneous-variables">
                   <div class="content-data">
















<ol class="breadcrumb">
  <li>Miscellaneous</li>
  <li>Variables</li>
</ol>

<section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <ul class="index-list">
                        <li>
                            <a href="#addUsers" title="src/database/databaseActions.ts" ><b>addUsers</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#addWidget" title="src/database/databaseActions.ts" ><b>addWidget</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#app" title="src/index.ts" ><b>app</b>&nbsp;&nbsp;&nbsp;(src/.../index.ts)</a>
                        </li>
                        <li>
                            <a href="#checkToken" title="src/routes/auth/tokenAction.ts" ><b>checkToken</b>&nbsp;&nbsp;&nbsp;(src/.../tokenAction.ts)</a>
                        </li>
                        <li>
                            <a href="#db" title="src/database/database.ts" ><b>db</b>&nbsp;&nbsp;&nbsp;(src/.../database.ts)</a>
                        </li>
                        <li>
                            <a href="#deleteWidget" title="src/database/databaseActions.ts" ><b>deleteWidget</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#getRow" title="src/database/databaseActions.ts" ><b>getRow</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#getUserByToken" title="src/database/databaseActions.ts" ><b>getUserByToken</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#getUsers" title="src/database/databaseActions.ts" ><b>getUsers</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#getWidgetsByUserId" title="src/database/databaseActions.ts" ><b>getWidgetsByUserId</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#handleOAuthUsers" title="src/routes/auth/authActions.ts" ><b>handleOAuthUsers</b>&nbsp;&nbsp;&nbsp;(src/.../authActions.ts)</a>
                        </li>
                        <li>
                            <a href="#handleOAuthUsersAction" title="src/routes/auth/authActions.ts" ><b>handleOAuthUsersAction</b>&nbsp;&nbsp;&nbsp;(src/.../authActions.ts)</a>
                        </li>
                        <li>
                            <a href="#registerBasicUser" title="src/routes/auth/registerActions.ts" ><b>registerBasicUser</b>&nbsp;&nbsp;&nbsp;(src/.../registerActions.ts)</a>
                        </li>
                        <li>
                            <a href="#routes" title="src/routes.ts" ><b>routes</b>&nbsp;&nbsp;&nbsp;(src/.../routes.ts)</a>
                        </li>
                        <li>
                            <a href="#server" title="src/index.ts" ><b>server</b>&nbsp;&nbsp;&nbsp;(src/.../index.ts)</a>
                        </li>
                        <li>
                            <a href="#TOKEN_WL" title="src/request_handler.ts" ><b>TOKEN_WL</b>&nbsp;&nbsp;&nbsp;(src/.../request_handler.ts)</a>
                        </li>
                        <li>
                            <a href="#updateInfos" title="src/database/databaseActions.ts" ><b>updateInfos</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#updateUserAuthToken" title="src/database/databaseActions.ts" ><b>updateUserAuthToken</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                        <li>
                            <a href="#updateUserInformations" title="src/routes/profile/profileActions.ts" ><b>updateUserInformations</b>&nbsp;&nbsp;&nbsp;(src/.../profileActions.ts)</a>
                        </li>
                        <li>
                            <a href="#updateWidget" title="src/database/databaseActions.ts" ><b>updateWidget</b>&nbsp;&nbsp;&nbsp;(src/.../databaseActions.ts)</a>
                        </li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    <h3>src/database/databaseActions.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addUsers"></a>
                    <span class="name">
                        <span ><b>addUsers</b></span>
                        <a href="#addUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (infos: UserInformations, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;INSERT into users (&quot;;
    let wasFound: boolean &#x3D; false;

    try {
        if (infos.mail !&#x3D;&#x3D; undefined) {
            query +&#x3D; &quot;mail, password) VALUES (&#x27;&quot;
                + infos.mail + &quot;&#x27;, &#x27;&quot; + infos.password + &quot;&#x27;);&quot;;
            wasFound &#x3D; true;
        }
        if (infos.google_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;google_mail, google_token) VALUES (&#x27;&quot;
                + infos.google_mail + &quot;&#x27;, &#x27;&quot; + infos.google_token + &quot;&#x27;);&quot;;
            wasFound &#x3D; true;
        }
        if (infos.facebook_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;facebook_mail, facebook_token) VALUES (&#x27;&quot;
                + infos.facebook_mail + &quot;&#x27;, &#x27;&quot; + infos.facebook_token + &quot;&#x27;);&quot;;
            wasFound &#x3D; true;
        }
        if (infos.apple_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;apple_mail, apple_token) VALUES (&#x27;&quot;
                + infos.apple_mail + &quot;&#x27;, &#x27;&quot; + infos.apple_token + &quot;&#x27;);&quot;;
            wasFound &#x3D; true;
        }
        if (infos.office_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;office_mail, office_token) VALUES (&#x27;&quot;
                + infos.office_mail + &quot;&#x27;, &#x27;&quot; + infos.office_token + &quot;&#x27;);&quot;;
            wasFound &#x3D; true;
        }

        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addWidget"></a>
                    <span class="name">
                        <span ><b>addWidget</b></span>
                        <a href="#addWidget"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (userId: string, widget: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;INSERT INTO widgets (user_id, data) VALUES (&#x27;&quot; + userId + &quot;&#x27;, &#x27;&quot; + JSON.stringify(widget) + &quot;&#x27;);&quot;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                console.debug(err);
                callback(err);
            } else {
                console.debug(result);
                callback(null, result);
            }
        });
    }
    catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteWidget"></a>
                    <span class="name">
                        <span ><b>deleteWidget</b></span>
                        <a href="#deleteWidget"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (userId: string, widgetId: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;DELETE FROM widgets WHERE user_id &#x3D; &#x27;&quot; + userId + &quot;&#x27; AND id &#x3D; &#x27;&quot; + widgetId + &quot;&#x27;;&quot;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                console.debug(err);
                callback(err);
            } else {
                console.debug(result);
                callback(null, result);
            }
        });
    }
    catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRow"></a>
                    <span class="name">
                        <span ><b>getRow</b></span>
                        <a href="#getRow"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (row: string, value: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;SELECT * FROM users WHERE &quot; + row + &quot; &#x3D; &#x27;&quot; + value + &quot;&#x27; LIMIT 1;&quot;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserByToken"></a>
                    <span class="name">
                        <span ><b>getUserByToken</b></span>
                        <a href="#getUserByToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (token: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;SELECT * FROM users WHERE token &#x3D; &#x27;&quot; + token + &quot;&#x27;;&quot;;
    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUsers"></a>
                    <span class="name">
                        <span ><b>getUsers</b></span>
                        <a href="#getUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (infos: UserInformations, callback: Function) &#x3D;&gt; {
    let wasFound: boolean &#x3D; false;
    let query: string &#x3D; &quot;SELECT * FROM users WHERE &quot;;

    try {
        if (infos.mail !&#x3D;&#x3D; undefined) {
            query +&#x3D; &quot;mail &#x3D; &#x27;&quot; + infos.mail + &quot;&#x27; AND password &#x3D; &#x27;&quot; + infos.password + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.google_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;google_mail &#x3D; &#x27;&quot; + infos.google_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.facebook_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;facebook_mail &#x3D; &#x27;&quot; + infos.facebook_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.apple_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;apple_mail &#x3D; &#x27;&quot; + infos.apple_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.office_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;office_mail &#x3D; &#x27;&quot; + infos.office_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }

        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });

    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getWidgetsByUserId"></a>
                    <span class="name">
                        <span ><b>getWidgetsByUserId</b></span>
                        <a href="#getWidgetsByUserId"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (userId: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;SELECT * FROM widgets WHERE user_id &#x3D; &#x27;&quot; + userId + &quot;&#x27;;&quot;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    }
    catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateInfos"></a>
                    <span class="name">
                        <span ><b>updateInfos</b></span>
                        <a href="#updateInfos"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (
    rows: Array&lt;string&gt;, newValues: Array&lt;string&gt;,
    whereRow: string, whereValue: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &#x27;UPDATE users SET &#x27;;

    for (let i &#x3D; 0; i &lt; rows.length; i++) {
        if (i !&#x3D;&#x3D; 0) {
            query +&#x3D; &#x27;, &#x27;;
        }
        query +&#x3D; rows[i] + &#x27; &#x3D; &#x27; + &#x60;&#x27;${newValues[i]}&#x27;&#x60;;
    }
    query +&#x3D; &#x27; WHERE &#x27; + whereRow + &#x27; &#x3D; &#x27; + &#x60;&#x27;${whereValue}&#x27;&#x60; + &#x27;;&#x27;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>updates a row in the users table</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserAuthToken"></a>
                    <span class="name">
                        <span ><b>updateUserAuthToken</b></span>
                        <a href="#updateUserAuthToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (infos: UserInformations, jwtToken: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;UPDATE users SET &quot;;
    let wasFound: boolean &#x3D; false;

    try {
        if (infos.mail !&#x3D;&#x3D; undefined) {
            query +&#x3D; &quot;token &#x3D; &#x27;&quot; + jwtToken + &quot;&#x27;, token_created_at &#x3D; &#x27;&quot;
                + moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &quot;&#x27; WHERE mail &#x3D; &#x27;&quot; + infos.mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.google_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;token &#x3D; &#x27;&quot; + jwtToken + &quot;&#x27;, token_created_at &#x3D; &#x27;&quot;
                + moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &quot;&#x27; WHERE google_mail &#x3D; &#x27;&quot; + infos.google_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.facebook_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;token &#x3D; &#x27;&quot; + jwtToken + &quot;&#x27;, token_created_at &#x3D; &#x27;&quot;
                + moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &quot;&#x27; WHERE facebook_mail &#x3D; &#x27;&quot; + infos.facebook_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.apple_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;token &#x3D; &#x27;&quot; + jwtToken + &quot;&#x27;, token_created_at &#x3D; &#x27;&quot;
                + moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &quot;&#x27; WHERE apple_mail &#x3D; &#x27;&quot; + infos.apple_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }
        if (infos.office_mail !&#x3D;&#x3D; undefined &amp;&amp; wasFound &#x3D;&#x3D;&#x3D; false) {
            query +&#x3D; &quot;token &#x3D; &#x27;&quot; + jwtToken + &quot;&#x27;, token_created_at &#x3D; &#x27;&quot;
                + moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) + &quot;&#x27; WHERE office_mail &#x3D; &#x27;&quot; + infos.office_mail + &quot;&#x27;;&quot;;
            wasFound &#x3D; true;
        }

        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err || result.affectedRows &#x3D;&#x3D;&#x3D; 0) {
                callback(err);
            } else {
                callback(null, result);
            }
        });
    } catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateWidget"></a>
                    <span class="name">
                        <span ><b>updateWidget</b></span>
                        <a href="#updateWidget"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (userId: string, widget: string, callback: Function) &#x3D;&gt; {
    let query: string &#x3D; &quot;UPDATE widgets SET data &#x3D; &#x27;&quot; + widget + &quot;&#x27; WHERE user_id &#x3D; &#x27;&quot; + userId + &quot;&#x27;;&quot;;

    try {
        db.query(query, (err: any, result: any) &#x3D;&gt; {
            if (err) {
                console.debug(err);
                callback(err);
            } else {
                console.debug(result);
                callback(null, result);
            }
        });
    }
    catch (err) {
        callback(err);
    }
}</code>
                    </td>
                </tr>


        </tbody>
    </table>
</section>
    <h3>src/index.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="app"></a>
                    <span class="name">
                        <span ><b>app</b></span>
                        <a href="#app"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>express()</code>
                    </td>
                </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="server"></a>
                    <span class="name">
                        <span ><b>server</b></span>
                        <a href="#server"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>require(&quot;http&quot;).Server(app)</code>
                    </td>
                </tr>


        </tbody>
    </table>
</section>
    <h3>src/routes/auth/tokenAction.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkToken"></a>
                    <span class="name">
                        <span ><b>checkToken</b></span>
                        <a href="#checkToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>(token: string, callback: Function) &#x3D;&gt; {
    const queryString: string &#x3D; &quot;SELECT * FROM users WHERE token &#x3D; &#x27;&quot; + token + &quot;&#x27; LIMIT 1;&quot;;
    db.query(queryString, (err: any, result: any) &#x3D;&gt; {
        if (err) {
            callback(err);
        } else {
            callback(null, result);
        }
    });
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>check if the given token correspond to a user&#39;s token</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>
    <h3>src/database/database.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="db"></a>
                    <span class="name">
                        <span ><b>db</b></span>
                        <a href="#db"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>mysql.createConnection({
    host: process.env.MY_SQL_HOST,
    user: process.env.MY_SQL_USER,
    password: process.env.MY_SQL_PASSWORD,
    database: process.env.MY_SQL_DATABASE,
})</code>
                    </td>
                </tr>


        </tbody>
    </table>
</section>
    <h3>src/routes/auth/authActions.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleOAuthUsers"></a>
                    <span class="name">
                        <span ><b>handleOAuthUsers</b></span>
                        <a href="#handleOAuthUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (req: express.Request, res: express.Response) &#x3D;&gt; {
    try {
        const type: string &#x3D; req.params.type;
        const { access_token } &#x3D; req.body;
        let user: { type: string, userJson: any } &#x3D; { type: &#x27;&#x27;, userJson: {} };
        let response: AxiosResponse;

        switch (type) {
            case &#x27;google_user&#x27;:
                console.log(&#x27;bearer token &#x3D;&#x3D; &#x27;, access_token);
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://www.googleapis.com/oauth2/v1/userinfo?alt&#x3D;json&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                console.debug(&quot;response &#x3D;&#x3D; &quot;, response.data);
                let googleUser &#x3D; response.data;
                user &#x3D; { type: &#x27;google_user&#x27;, userJson: googleUser };
                break;
            case &#x27;facebook_user&#x27;:
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://graph.facebook.com/me/?fields&#x3D;id,name,email&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                let facebookUser &#x3D; response.data;
                user &#x3D; { type: &#x27;facebook_user&#x27;, userJson: facebookUser };
                break;
            case &#x27;office_user&#x27;:
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://graph.microsoft.com/v1.0/me&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                console.log(&quot;response &#x3D;&#x3D; &quot;, response.data);
                let officeUser &#x3D; response.data;
                user &#x3D; { type: &#x27;office_user&#x27;, userJson: officeUser };
                break;
            default:
                return res.status(400).json({ message: &#x27;Bad request&#x27; });
        }

        const infos: UserInformations &#x3D; {
            mail: undefined,
            google_mail: (user.type &#x3D;&#x3D;&#x3D; &#x27;google_user&#x27;) ? user.userJson.email : undefined,
            google_token: (user.type &#x3D;&#x3D;&#x3D; &#x27;google_user&#x27;) ? access_token : undefined,
            facebook_mail: (user.type &#x3D;&#x3D;&#x3D; &#x27;facebook_user&#x27;) ? user.userJson.email : undefined,
            facebook_token: (user.type &#x3D;&#x3D;&#x3D; &#x27;facebook_user&#x27;) ? access_token : undefined,
            apple_mail: (user.type &#x3D;&#x3D;&#x3D; &#x27;apple_user&#x27;) ? user.userJson.email : undefined,
            apple_token: (user.type &#x3D;&#x3D;&#x3D; &#x27;apple_user&#x27;) ? access_token : undefined,
            office_mail: (user.type &#x3D;&#x3D;&#x3D; &#x27;office_user&#x27;) ? user.userJson.mail : undefined,
            office_token: (user.type &#x3D;&#x3D;&#x3D; &#x27;office_user&#x27;) ? access_token : undefined,
            username: undefined,
            password: undefined,
        };

        const result &#x3D; await handleOAuthUsersAction(infos);
        if (result.error &#x3D;&#x3D;&#x3D; true) {
            return res.status(500).json({
                error: result.error,
                message: result.message,
            });
        }
        if (result.message &#x3D;&#x3D;&#x3D; &quot;user created&quot;) {
            return res.status(200).json({ error: false, message: &quot;user created&quot;, result: result.result });
        }
        if (result.message &#x3D;&#x3D;&#x3D; &quot;user already exists&quot;) {
            const expiresIn: number &#x3D; Number(process.env.EXPIRE_TIME) || 60 * 60;
            const payload &#x3D; {
                mail: (user.type &#x3D;&#x3D;&#x3D; &#x27;google_user&#x27;) ? user.userJson.email : (user.type &#x3D;&#x3D;&#x3D; &#x27;facebook_user&#x27;) ? user.userJson.email : (user.type &#x3D;&#x3D;&#x3D; &#x27;apple_user&#x27;) ? user.userJson.email : (user.type &#x3D;&#x3D;&#x3D; &#x27;office_user&#x27;) ? user.userJson.email : &quot;none&quot;,
            };
            const token: string &#x3D; jwt.sign(
                payload,
                process.env.JWT_SECRET,
                { expiresIn: expiresIn }
            );
            await updateUserAuthToken(infos, token, (err: any, result: any) &#x3D;&gt; {
                if (err) {
                    console.debug(&#x27;[handleOAuthUsersAction] | error[updateUserAuthToken] &#x3D; &#x27;, err);
                } else {
                    console.debug(&#x27;[handleOAuthUsersAction] | result[updateUserAuthToken] &#x3D; &#x27;, result);
                }
            });
            return res.status(200).json({ error: false, message: &quot;user logged in&quot;, expiresIn: expiresIn, token: token, result: result.result });
        }
    } catch (err) {
        console.debug(&#x27;[handleOAuthUsersAction] | error &#x3D; &#x27;, err);
        return res.status(500).json({ error: true, message: &quot;server error&quot; });
    }
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>handle the login or the registration of a OAuth&#39;s user (a user logged on signed in with a google/facebook/office account)</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleOAuthUsersAction"></a>
                    <span class="name">
                        <span ><b>handleOAuthUsersAction</b></span>
                        <a href="#handleOAuthUsersAction"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (infos: UserInformations): Promise&lt;{ error: boolean, message: string, result?: any }&gt; &#x3D;&gt; {
    return new Promise(async (resolve, reject) &#x3D;&gt; {
        await getUsers(infos, async (err: any, result: any) &#x3D;&gt; {
            if (err) {
                console.debug(&#x27;[handleOAuthUsersAction] | error[getUsers] &#x3D; &#x27;, err);
                await addUsers(infos, (err: any, result: any) &#x3D;&gt; {
                    if (err) {
                        console.debug(&#x27;[handleOAuthUsersAction] | error[addUsers] &#x3D; &#x27;, err);
                        return resolve({ error: true, message: &quot;internal error&quot; });
                    } else {
                        console.debug(&#x27;[handleOAuthUsersAction] | result[addUsers] &#x3D; &#x27;, result);
                        return resolve({ error: false, message: &quot;user created&quot;, result: result });
                    }
                });
            } else {
                console.debug(&#x27;[handleOAuthUsersAction] | result[getUsers] &#x3D; &#x27;, result);
                if (result.length &#x3D;&#x3D;&#x3D; 0) {
                    await addUsers(infos, (err: any, result: any) &#x3D;&gt; {
                        if (err) {
                            console.debug(&#x27;[handleOAuthUsersAction] | error[addUsers] &#x3D; &#x27;, err);
                            return resolve({ error: true, message: &quot;internal error&quot; });
                        } else {
                            console.debug(&#x27;[handleOAuthUsersAction] | result[addUsers] &#x3D; &#x27;, result);
                            return resolve({ error: false, message: &quot;user created&quot;, result: result });
                        }
                    });
                } else {
                    return resolve({ error: false, message: &quot;user already exists&quot;, result: result });
                }
            }
        });
    });
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>save or get user from / in database</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>
    <h3>src/routes/auth/registerActions.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="registerBasicUser"></a>
                    <span class="name">
                        <span ><b>registerBasicUser</b></span>
                        <a href="#registerBasicUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (infos: UserInformations): Promise&lt;{ error: boolean, message: string, result?: any }&gt; &#x3D;&gt; {
    return new Promise(async (resolve, reject) &#x3D;&gt; {
        await getUsers(infos, async (err: any, result: any) &#x3D;&gt; {
            if (err) {
                console.debug(&#x27;[handleOAuthUsersAction] | error[getUsers] &#x3D; &#x27;, err);
                await addUsers(infos, (err: any, result: any) &#x3D;&gt; {
                    if (err) {
                        console.debug(&#x27;[handleOAuthUsersAction] | error[addUsers] &#x3D; &#x27;, err);
                        return resolve({ error: true, message: &quot;internal error&quot; });
                    } else {
                        console.debug(&#x27;[handleOAuthUsersAction] | result[addUsers] &#x3D; &#x27;, result);
                        return resolve({ error: false, message: &quot;user created&quot;, result: result });
                    }
                });
            } else {
                console.debug(&#x27;[handleOAuthUsersAction] | result[getUsers] &#x3D; &#x27;, result);
                if (result.length &#x3D;&#x3D;&#x3D; 0) {
                    await addUsers(infos, (err: any, result: any) &#x3D;&gt; {
                        if (err) {
                            console.debug(&#x27;[handleOAuthUsersAction] | error[addUsers] &#x3D; &#x27;, err);
                            return resolve({ error: true, message: &quot;internal error&quot; });
                        } else {
                            console.debug(&#x27;[handleOAuthUsersAction] | result[addUsers] &#x3D; &#x27;, result);
                            return resolve({ error: false, message: &quot;user created&quot;, result: result });
                        }
                    });
                } else {
                    return resolve({ error: false, message: &quot;user already exists&quot;, result: result });
                }
            }
        });
    });
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>save a user in the database if it doesn&#39;t already exists</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>
    <h3>src/routes.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="routes"></a>
                    <span class="name">
                        <span ><b>routes</b></span>
                        <a href="#routes"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>literal type[]</code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>


        </tbody>
    </table>
</section>
    <h3>src/request_handler.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="TOKEN_WL"></a>
                    <span class="name">
                        <span ><b>TOKEN_WL</b></span>
                        <a href="#TOKEN_WL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>/(register|login)/</code>
                    </td>
                </tr>


        </tbody>
    </table>
</section>
    <h3>src/routes/profile/profileActions.ts</h3>
    <section>
    <h3></h3>    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserInformations"></a>
                    <span class="name">
                        <span ><b>updateUserInformations</b></span>
                        <a href="#updateUserInformations"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>async (req: express.Request, res: express.Response) &#x3D;&gt; {
    try {
        const type: string &#x3D; req.params.type;
        const { access_token } &#x3D; req.body;
        let token: string &#x3D; req.headers.authorization;
        token &#x3D; token.split(&quot; &quot;)[1];
        let response: AxiosResponse;
        let user: { type: string, userJson: any } &#x3D; { type: &#x27;&#x27;, userJson: {} };

        switch (type) {
            case &#x27;google_user&#x27;:
                console.log(&#x27;bearer token &#x3D;&#x3D; &#x27;, access_token);
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://www.googleapis.com/oauth2/v1/userinfo?alt&#x3D;json&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                let googleUser &#x3D; response.data;
                user &#x3D; { type: &#x27;google_user&#x27;, userJson: googleUser };
                break;
            case &#x27;facebook_user&#x27;:
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://graph.facebook.com/me/?fields&#x3D;id,name,email&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                let facebookUser &#x3D; response.data;
                user &#x3D; { type: &#x27;facebook_user&#x27;, userJson: facebookUser };
                break;
            case &#x27;office_user&#x27;:
                response &#x3D; await axios({
                    method: &#x27;GET&#x27;,
                    url: &#x27;https://graph.microsoft.com/v1.0/me&#x27;,
                    headers: {
                        &#x27;Authorization&#x27;: &#x60;Bearer ${access_token}&#x60;
                    },
                });
                let officeUser &#x3D; response.data;
                user &#x3D; { type: &#x27;office_user&#x27;, userJson: officeUser };
                break;
            case &#x27;plain_user&#x27;:
                let plainUser &#x3D; {
                    mail: req.body.mail,
                    password: req.body.password,
                };
                user &#x3D; { type: &#x27;plain_user&#x27;, userJson: plainUser };
                break;
            default:
                return res.status(400).json({ message: &#x27;Bad request&#x27; });
        };

        if (user.type &#x3D;&#x3D;&#x3D; &#x27;google_user&#x27;) {
            console.log(&quot;heeeeerererere&quot;);
            await updateInfos([&#x27;google_mail&#x27;, &#x27;google_token&#x27;], [user.userJson.email, access_token], &quot;token&quot;, token, (err: Error, result: any) &#x3D;&gt; {
                if (err) {
                    console.log(&quot;heeeeerererere2 &quot;, err);
                    return res.status(500).json({ message: &#x27;Internal server error&#x27; });
                }
                return res.status(200).json({ message: &#x27;User informations updated&#x27;, google_token: access_token });
            });
        }
        if (user.type &#x3D;&#x3D;&#x3D; &#x27;office_user&#x27;) {
            await updateInfos([&#x27;office_mail&#x27;, &#x27;office_token&#x27;], [user.userJson.email, access_token], &quot;token&quot;, token, (err: Error, result: any) &#x3D;&gt; {
                if (err) {
                    return res.status(500).json({ message: &#x27;Internal server error&#x27; });
                }
                return res.status(200).json({ message: &#x27;User informations updated&#x27;, office_token: access_token });
            });
        }
        if (user.type &#x3D;&#x3D;&#x3D; &#x27;facebook_user&#x27;) {
            await updateInfos([&#x27;facebook_mail&#x27;, &#x27;facebook_token&#x27;], [user.userJson.email, access_token], &quot;token&quot;, token, (err: Error, result: any) &#x3D;&gt; {
                if (err) {
                    return res.status(500).json({ message: &#x27;Internal server error&#x27; });
                }
                return res.status(200).json({ message: &#x27;User informations updated&#x27;, facebook_token: access_token });
            });
        }
        if (user.type &#x3D;&#x3D;&#x3D; &#x27;plain_user&#x27;) {
            await updateInfos([&#x27;mail&#x27;, &#x27;password&#x27;], [user.userJson.mail, user.userJson.password], &quot;token&quot;, token, (err: Error, result: any) &#x3D;&gt; {
                if (err) {
                    return res.status(500).json({ message: &#x27;Internal server error&#x27; });
                }
                return res.status(200).json({ message: &#x27;User informations updated&#x27; });
            });
        }
    } catch (error) {
        return res.status(500).json({ message: &#x27;server error&#x27; });
    }
}</code>
                    </td>
                </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>update a user informations</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>



                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'miscellaneous-variables';
            var COMPODOC_CURRENT_PAGE_URL = 'variables.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
